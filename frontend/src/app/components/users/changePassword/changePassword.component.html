<div class="login-page">
  <div class="login-card">
    <h2 class="title">Change Password</h2>
    <p class="subtitle">Update your account password</p>

    <form #changeForm="ngForm" (ngSubmit)="onChangePassword(changeForm)">
      <div class="input-group">
        <label>Username</label>
        <input [(ngModel)]="form.username" name="username" required #userCtrl="ngModel" />
        <p class="validation" *ngIf="userCtrl.invalid && userCtrl.touched">Username required</p>
      </div>
      <div class="input-group">
        <label>New Password</label>
        <div class="password-wrapper">
          <input
            [(ngModel)]="form.password"
            name="password"
            required
            [type]="showPassword ? 'text' : 'password'"
            #newCtrl="ngModel"
          />
          <img
            class="toggle-icon"
            (click)="togglePassword()"
            [src]="showPassword ? 'eye-slash.svg' : 'eye.svg'"
            alt="toggle password"
          />
        </div>
        <p class="validation" *ngIf="newCtrl.invalid && newCtrl.touched">New password required</p>
      </div>
      <div class="input-group">
        <label>Confirm New Password</label>
        <div class="password-wrapper">
          <input
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            [type]="showPassword ? 'text' : 'password'"
            required
            #confCtrl="ngModel"
          />
        </div>
        <p class="validation" *ngIf="form.password !== confirmPassword && confCtrl.touched">
          Passwords do not match
        </p>
      </div>
      <button
        class="login-btn"
        [disabled]="changeForm.invalid || form.password !== confirmPassword || loading"
      >
        <span *ngIf="!loading">Update Password</span>
        <span *ngIf="loading" class="spinner"></span>
      </button>

      <div class="links">
        <a routerLink="/login">Back to Login</a>
      </div>
    </form>

    <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
  </div>
</div>

<app-popup
  [show]="showPopup"
  [title]="popupTitle"
  [message]="popupMessage"
  [samePage]="samePage"
  (closed)="showPopup = false"
>
</app-popup>
